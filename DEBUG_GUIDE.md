# 🔍 增强DNM框架调试指南

## 概述

增强DNM框架现在包含了详细的调试输出功能，帮助您深入了解形态发生过程的每个步骤。

## 🎨 调试输出特性

### 彩色输出
- 🔵 **INFO**: 青色 - 一般信息
- 🟢 **SUCCESS**: 绿色 - 成功操作  
- 🟡 **WARNING**: 黄色 - 警告信息
- 🔴 **ERROR**: 红色 - 错误信息
- 🟣 **DEBUG**: 紫色 - 调试详情

### 层次化输出
调试信息采用缩进结构，清晰显示调用栈和执行流程。

## 🚀 使用方法

### 1. 基本测试
```bash
python debug_test_enhanced_dnm.py
```

### 2. 禁用调试输出
如果您想禁用调试输出，可以修改代码：

```python
# 在 enhanced_dnm_framework.py 中
debug_printer = DebugPrinter(enabled=False)

# 在 advanced_morphogenesis.py 中  
morpho_debug = DebugPrinter(enabled=False)
```

### 3. 自定义调试级别
您可以通过修改 `print_debug` 方法来过滤特定级别的调试信息。

## 📊 调试输出内容

### 1. 形态发生触发检查
- Epoch信息和触发间隔
- 各触发器的检查结果
- 触发器激活统计

### 2. 瓶颈分析
- 输入数据统计
- 5维瓶颈分析进度
- 各类型瓶颈数量统计

### 3. 复杂度分数计算
- 各层激活值和梯度信息
- 信息熵、梯度复杂度、激活复杂度
- 层级分数和最终分数

### 4. 形态发生执行
- 模型信息（参数数量、设备等）
- 执行策略和目标位置
- 参数增长统计
- 成功/失败状态

## 🧬 调试示例输出

```
[14:30:15] DEBUG: 🔍 进入 形态发生触发检查
[14:30:15]   INFO: 当前epoch: 0, 触发间隔: 3
[14:30:15]   INFO: ❌ 不在触发间隔内 (0 % 3 != 0)
[14:30:15] DEBUG: ✅ 完成 形态发生触发检查

[14:30:18] DEBUG: 🔍 进入 信息论触发器检查
[14:30:18] DEBUG:   输入数据: 激活值层数=3, 梯度层数=3
[14:30:18] DEBUG: 🔍 进入 复杂度分数计算
[14:30:18] DEBUG:     📊 激活值[0]: shape=[32, 128], dtype=torch.float32, device=(cuda:0)
[14:30:18] DEBUG:     📊 梯度[0]: shape=[128, 784], dtype=torch.float32, device=(cuda:0)
[14:30:18] DEBUG:     信息熵[0]: 0.8234
[14:30:18] DEBUG:     梯度复杂度[0]: 0.7456
[14:30:18] DEBUG:     激活复杂度[0]: 0.6789
[14:30:18] DEBUG:     层分数[0]: 0.7493
[14:30:18]   INFO:     最终复杂度分数: 0.7123 (共3层)
[14:30:18] DEBUG: ✅ 完成 复杂度分数计算
[14:30:18] SUCCESS: ✅ 触发条件满足: 0.7123 > 0.6000
[14:30:18] DEBUG: ✅ 完成 信息论触发器检查
```

## 🔧 故障排除

### 常见问题

1. **ImportError**: 确保所有依赖已安装
   ```bash
   pip install torch numpy
   ```

2. **CUDA错误**: 如果没有GPU，代码会自动使用CPU
   
3. **内存不足**: 减少批次大小或模型尺寸

### 错误信息解读

- `❌ 缺少激活值或梯度信息`: 检查数据收集过程
- `❌ 未满足触发条件`: 正常，大多数epoch不会触发形态发生
- `❌ 形态发生执行失败`: 检查模型兼容性和设备设置

## 🎯 性能建议

1. **生产环境**: 禁用调试输出以提高性能
2. **开发阶段**: 使用完整调试输出排查问题
3. **自动化测试**: 只启用ERROR级别输出

## 📝 日志输出

除了控制台彩色输出，框架还支持标准logging模块：

```python
import logging
logging.basicConfig(level=logging.DEBUG, filename='dnm_debug.log')
```

## 💡 高级技巧

### 1. 选择性调试
```python
# 只调试特定模块
debug_printer.enabled = True  # 主框架
morpho_debug.enabled = False  # 形态发生模块
```

### 2. 自定义调试信息
```python
debug_printer.print_debug("自定义调试信息", "INFO")
```

### 3. 错误追踪
框架会自动打印完整的错误堆栈，帮助定位问题。

---

📧 如有问题，请查看控制台输出中的详细错误信息。