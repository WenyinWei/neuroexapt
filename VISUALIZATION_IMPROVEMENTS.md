# å¯è§†åŒ–æ¨¡å—æ”¹è¿›æ€»ç»“

## æ¦‚è¿°

æ ¹æ®ç”¨æˆ·çš„è¦æ±‚ï¼Œæˆ‘ä»¬å¯¹ Neuro Exapt çš„å¯è§†åŒ–æ¨¡å—è¿›è¡Œäº†å…¨é¢æ”¹è¿›ï¼Œä½¿å…¶æ›´åŠ ç¾Žè§‚ã€ä¿¡æ¯ä¸°å¯Œä¸”æ˜“äºŽç†è§£ã€‚

## ðŸŽ¯ ç”¨æˆ·éœ€æ±‚åˆ†æž

### åŽŸå§‹é—®é¢˜
1. **å±‚åç§°å†—ä½™**: `model.conv1: Conv2d` æ˜¾ç¤ºå¤ªç´¯èµ˜
2. **å¯¹é½é—®é¢˜**: ç®­å¤´å’Œå±‚åç§°æ²¡æœ‰å±…ä¸­å¯¹é½
3. **ç»´åº¦ä¿¡æ¯ç¼ºå¤±**: ç¼ºå°‘è¾“å…¥è¾“å‡ºç»´åº¦ä¿¡æ¯
4. **å‚æ•°æ˜¾ç¤ºä¸ç›´è§‚**: å¤§æ•°å­—éš¾ä»¥å¿«é€Ÿç†è§£
5. **å˜æ›´æ ‡è¯†ä¸æ˜Žæ˜¾**: éœ€è¦ç”¨é¢œè‰²é«˜äº®å˜åŠ¨çš„å±‚
6. **åˆ é™¤å±‚æ˜¾ç¤º**: éœ€è¦ç”¨åˆ é™¤çº¿è¡¨ç¤ºè¢«åˆ é™¤çš„å±‚

### ç”¨æˆ·å…·ä½“è¦æ±‚
- âœ… ç®€åŒ–å±‚åç§°ï¼š`model.conv1` â†’ `conv1`
- âœ… ä¼˜åŒ–å¯¹é½ï¼šå±‚åç§°å’Œç®­å¤´å±…ä¸­å¯¹é½
- âœ… æ·»åŠ ç»´åº¦ï¼šæ˜¾ç¤ºå¦‚ `1920Ã—720` çš„é•¿å®½è¡¨è¾¾å¼
- âœ… é¢œè‰²é«˜äº®ï¼šæ–°å¢žå±‚ç”¨äº®è‰²ï¼Œåˆ é™¤å±‚ç”¨åˆ é™¤çº¿
- âœ… å‚æ•°æ ¼å¼ï¼šä½¿ç”¨ M/K æ ¼å¼è€Œéžçº¯æ•°å­—

## ðŸš€ å®žçŽ°çš„æ”¹è¿›

### 1. **å±‚åç§°ç®€åŒ–** âœ¨
```python
def _simplify_layer_name(layer_name: str) -> str:
    """ç®€åŒ–å±‚åç§°æ˜¾ç¤º"""
    prefixes_to_remove = ['model.', 'net.', 'backbone.', 'features.', 'classifier.']
    # è‡ªåŠ¨åŽ»é™¤å¸¸è§å‰ç¼€
```

**æ•ˆæžœå¯¹æ¯”:**
- æ”¹è¿›å‰: `model.conv1: Conv2d (896 params)`
- æ”¹è¿›åŽ: `conv1 Conv2d (896)`

### 2. **å‚æ•°è®¡æ•°æ ¼å¼åŒ–** ðŸ“Š
```python
def _format_parameter_count(param_count: int) -> str:
    """äººæ€§åŒ–çš„å‚æ•°è®¡æ•°æ ¼å¼"""
    if param_count >= 1_000_000:
        return f"{param_count / 1_000_000:.1f}M"
    elif param_count >= 1_000:
        return f"{param_count / 1_000:.1f}K"
    else:
        return str(param_count)
```

**æ•ˆæžœå¯¹æ¯”:**
- æ”¹è¿›å‰: `(524544 params)`
- æ”¹è¿›åŽ: `524.5K`

### 3. **è¾“å…¥è¾“å‡ºç»´åº¦æ˜¾ç¤º** ðŸ”
```python
def _get_layer_input_output_dims(model, layer_name, sample_input=None):
    """èŽ·å–å±‚çš„è¾“å…¥è¾“å‡ºç»´åº¦ä¿¡æ¯"""
    # è‡ªåŠ¨æ£€æµ‹å±‚ç±»åž‹å¹¶æ˜¾ç¤ºç›¸åº”çš„ç»´åº¦ä¿¡æ¯
```

**ç»´åº¦æ ¼å¼:**
- **å·ç§¯å±‚**: `(C3â†’C32)` - é€šé“æ•°å˜åŒ–
- **çº¿æ€§å±‚**: `([2048]â†’[256])` - ç‰¹å¾æ•°å˜åŒ–
- **æ± åŒ–å±‚**: `Pool2Ã—2` - æ± åŒ–æ ¸å¤§å°

### 4. **å½©è‰²çŠ¶æ€æ ‡è¯†** ðŸŽ¨
```python
# çŠ¶æ€é¢œè‰²å®šä¹‰
GREEN = '\033[92m'      # âœ“ æ–°å¢žå±‚
RED = '\033[91m'        # âœ— åˆ é™¤å±‚  
YELLOW = '\033[93m'     # ~ ä¿®æ”¹å±‚
BLUE = '\033[94m'       # æ­£å¸¸å±‚
STRIKETHROUGH = '\033[9m'  # åˆ é™¤çº¿
```

**çŠ¶æ€æ ‡è¯†:**
- ðŸŸ¢ `âœ“` **æ–°å¢žå±‚**: ç»¿è‰²é«˜äº® + ç²—ä½“
- ðŸ”´ `âœ—` **åˆ é™¤å±‚**: çº¢è‰² + åˆ é™¤çº¿
- ðŸŸ¡ `~` **ä¿®æ”¹å±‚**: é»„è‰²é«˜äº®
- ðŸ”µ ` ` **æ­£å¸¸å±‚**: è“è‰²æ­£å¸¸æ˜¾ç¤º

### 5. **å±…ä¸­å¯¹é½å’Œç®­å¤´ä¼˜åŒ–** â¬‡ï¸
```python
# å±…ä¸­å¯¹é½çš„å±‚æ˜¾ç¤º
content = f"{layer_repr} {dim_info} {param_info}"
lines.append(f"{'':>10}{content}")

# ç®­å¤´åœ¨å±‚ä¹‹é—´å±…ä¸­
if i < total_layers - 1:
    lines.append(f"{MAGENTA}{'':>25}â†“{RESET}")
```

**å¯¹é½æ•ˆæžœ:**
```
           conv1 Conv2d (C3â†’C32) 896
                         â†“
          ~conv2 Conv2d (C32â†’C64) 18.5K
                         â†“
```

### 6. **å¤šåˆ†æ”¯æž¶æž„æ”¯æŒ** ðŸŒ³
```python
# è‡ªåŠ¨æ£€æµ‹å¤šåˆ†æ”¯æž¶æž„
has_branches = any(name.startswith(('branch_', 'main_branch', 'secondary_branch')) 
                   for name in all_layers)

# å¹¶è¡Œæ˜¾ç¤ºåˆ†æ”¯
for depth in range(max_branch_depth):
    row_parts = []
    for branch_name in branch_names:
        # å¹¶æŽ’æ˜¾ç¤ºå„åˆ†æ”¯çš„å±‚
```

**å¤šåˆ†æ”¯æ˜¾ç¤ºæ•ˆæžœ:**
```
ðŸ“Š Multi-Branch Architecture
main_branch_conv1 â”‚ secondary_branch_conv1 â”‚ attention_branch_conv1
       â†“          â”‚          â†“             â”‚          â†“
main_branch_conv2 â”‚ secondary_branch_conv2 â”‚          
                  
                  â†“ Feature Fusion â†“
                  
              fusion_conv Conv2d
```

### 7. **å›¾ä¾‹å’Œè¯´æ˜Ž** ðŸ“–
```python
# æ·»åŠ æ¸…æ™°çš„å›¾ä¾‹è¯´æ˜Ž
lines.append(f"{BOLD}Legend:{RESET}")
lines.append(f"  {GREEN}âœ“ New layers{RESET}   {RED}âœ— Removed layers{RESET}   {YELLOW}~ Changed layers{RESET}")
lines.append(f"  {CYAN}(inputâ†’output){RESET} dimensions   Parameters in M/K format")
```

## ðŸ“ˆ åŠŸèƒ½å¯¹æ¯”

### æ”¹è¿›å‰çš„å¯è§†åŒ–
```
Current Model Architecture:
--------------------------------------------------
model.conv1: Conv2d (896 params)
model.conv2: Conv2d (18496 params)  
model.conv3: Conv2d (73856 params)
model.fc1: Linear (524544 params)
model.fc2: Linear (32896 params)
model.fc3: Linear (1290 params)
--------------------------------------------------
Total parameters: 651,978
```

### æ”¹è¿›åŽçš„å¯è§†åŒ–
```
ðŸ—ï¸  Dynamic Architecture Visualization
======================================================================
ðŸ“ˆ Sequential Architecture
---------------------------------------------
           conv1 Conv2d (C3â†’C32) 896
                         â†“
          ~conv2 Conv2d (C32â†’C64) 18.5K
                         â†“
           conv3 Conv2d (C64â†’C128) 73.9K
                         â†“
          ~fc1 Linear ([2048]â†’[256]) 524.5K
                         â†“
           fc2 Linear ([256]â†’[128]) 32.9K
                         â†“
           fc3 Linear ([128]â†’[10]) 1.3K

======================================================================
ðŸ“Š Total Parameters: 652.0K

Legend:
  âœ“ New layers   âœ— Removed layers   ~ Changed layers
  (inputâ†’output) dimensions   Parameters in M/K format
======================================================================
```

## ðŸ”§ æŠ€æœ¯å®žçŽ°ç»†èŠ‚

### æ ¸å¿ƒå‡½æ•°

#### 1. `_simplify_layer_name()`
- **åŠŸèƒ½**: è‡ªåŠ¨åŽ»é™¤å¸¸è§çš„æ¨¡åž‹å‰ç¼€
- **æ”¯æŒå‰ç¼€**: `model.`, `net.`, `backbone.`, `features.`, `classifier.`
- **ç¤ºä¾‹**: `model.conv1` â†’ `conv1`

#### 2. `_format_parameter_count()`
- **åŠŸèƒ½**: å°†å‚æ•°æ•°é‡æ ¼å¼åŒ–ä¸ºäººæ€§åŒ–æ˜¾ç¤º
- **æ ¼å¼**: 
  - `>= 1M`: `1.2M`
  - `>= 1K`: `34.5K`
  - `< 1K`: `896`

#### 3. `_get_layer_input_output_dims()`
- **åŠŸèƒ½**: è‡ªåŠ¨æ£€æµ‹å±‚çš„è¾“å…¥è¾“å‡ºç»´åº¦
- **æ”¯æŒå±‚ç±»åž‹**:
  - `Conv2d`: `(C3â†’C32)` - é€šé“ç»´åº¦
  - `Linear`: `([2048]â†’[256])` - ç‰¹å¾ç»´åº¦
  - `MaxPool2d`: `Pool2Ã—2` - æ± åŒ–æ ¸å¤§å°
  - `BatchNorm2d`: `BN64` - ç‰¹å¾æ•°é‡

#### 4. `ascii_model_graph()`
- **åŠŸèƒ½**: ä¸»è¦çš„å¯è§†åŒ–å‡½æ•°
- **ç‰¹æ€§**:
  - è‡ªåŠ¨æ£€æµ‹æž¶æž„ç±»åž‹ï¼ˆåºåˆ—/å¤šåˆ†æ”¯ï¼‰
  - æ”¯æŒæ¨¡åž‹å¯¹æ¯”æ˜¾ç¤º
  - å½©è‰²çŠ¶æ€æ ‡è¯†
  - å±…ä¸­å¯¹é½
  - ç»´åº¦ä¿¡æ¯æ˜¾ç¤º

### é¢œè‰²ç³»ç»Ÿ

```python
# ANSI é¢œè‰²ä»£ç ç³»ç»Ÿ
GREEN = '\033[92m'      # æ–°å¢žå±‚ (âœ“)
RED = '\033[91m'        # åˆ é™¤å±‚ (âœ—)
YELLOW = '\033[93m'     # ä¿®æ”¹å±‚ (~)
BLUE = '\033[94m'       # æ­£å¸¸å±‚ ( )
CYAN = '\033[96m'       # ç»´åº¦ä¿¡æ¯
MAGENTA = '\033[95m'    # ç®­å¤´
BOLD = '\033[1m'        # ç²—ä½“
STRIKETHROUGH = '\033[9m'  # åˆ é™¤çº¿
RESET = '\033[0m'       # é‡ç½®
```

## ðŸŽ¨ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨
```python
from neuroexapt.utils.visualization import ascii_model_graph

# åŸºç¡€å¯è§†åŒ–
ascii_model_graph(model)

# é«˜äº®ç‰¹å®šå±‚çš„å˜åŒ–
ascii_model_graph(model, changed_layers=['conv2', 'fc1'])
```

### æ¨¡åž‹æ¼”åŒ–å¯¹æ¯”
```python
# æ˜¾ç¤ºæ¼”åŒ–å‰åŽçš„å¯¹æ¯”
ascii_model_graph(
    evolved_model, 
    previous_model=original_model,
    changed_layers=['conv4', 'fc1', 'fc2']
)
```

### ç®€åŒ–æ¦‚è§ˆ
```python
from neuroexapt.utils.visualization import print_architecture

# ç®€åŒ–çš„æž¶æž„æ¦‚è§ˆ
print_architecture(model, changed_layers=['conv2', 'fc1'])
```

## ðŸŒŸ æ”¹è¿›æ•ˆæžœ

### 1. **å¯è¯»æ€§æå‡**
- å±‚åç§°æ›´ç®€æ´ï¼Œä¸€ç›®äº†ç„¶
- å‚æ•°è®¡æ•°æ›´ç›´è§‚ï¼ˆM/Kæ ¼å¼ï¼‰
- ç»´åº¦ä¿¡æ¯å¸®åŠ©ç†è§£æ•°æ®æµ

### 2. **è§†è§‰æ•ˆæžœæ”¹å–„**
- å½©è‰²çŠ¶æ€æ ‡è¯†æ¸…æ™°æ˜Žäº†
- å±…ä¸­å¯¹é½æ›´åŠ ç¾Žè§‚
- åˆ é™¤çº¿æ¸…æ¥šè¡¨ç¤ºè¢«ç§»é™¤çš„å±‚

### 3. **ä¿¡æ¯å¯†åº¦ä¼˜åŒ–**
- åœ¨æœ‰é™ç©ºé—´å†…æ˜¾ç¤ºæ›´å¤šæœ‰ç”¨ä¿¡æ¯
- ç»´åº¦å˜åŒ–ä¸€ç›®äº†ç„¶
- å‚æ•°å˜åŒ–è¶‹åŠ¿æ¸…æ™°

### 4. **å¤šæž¶æž„æ”¯æŒ**
- è‡ªåŠ¨è¯†åˆ«åºåˆ—å’Œå¤šåˆ†æ”¯æž¶æž„
- å¹¶è¡Œåˆ†æ”¯çš„æ¸…æ™°å¯è§†åŒ–
- ç‰¹å¾èžåˆç‚¹çš„æ˜Žç¡®æ ‡è¯†

## ðŸ”® æœªæ¥æ‰©å±•å¯èƒ½

### 1. **æ›´ä¸°å¯Œçš„ç»´åº¦ä¿¡æ¯**
- æ”¯æŒå®žé™…çš„ç©ºé—´ç»´åº¦æ˜¾ç¤ºï¼ˆå¦‚ `32Ã—32â†’16Ã—16`ï¼‰
- åŠ¨æ€è®¡ç®—ç‰¹å¾å›¾å°ºå¯¸
- æ˜¾ç¤ºæ„Ÿå—é‡Žä¿¡æ¯

### 2. **äº¤äº’å¼å¯è§†åŒ–**
- æ”¯æŒç‚¹å‡»å±•å¼€å±‚çš„è¯¦ç»†ä¿¡æ¯
- å¯æŠ˜å çš„åˆ†æ”¯æ˜¾ç¤º
- å®žæ—¶çš„å‚æ•°å˜åŒ–åŠ¨ç”»

### 3. **å¯¼å‡ºåŠŸèƒ½**
- æ”¯æŒå¯¼å‡ºä¸ºå›¾ç‰‡æ ¼å¼
- ç”Ÿæˆ HTML äº¤äº’å¼æŠ¥å‘Š
- é›†æˆåˆ° TensorBoard

### 4. **æ€§èƒ½åˆ†æžé›†æˆ**
- æ˜¾ç¤ºæ¯å±‚çš„è®¡ç®—é‡ï¼ˆFLOPsï¼‰
- å†…å­˜ä½¿ç”¨æƒ…å†µå¯è§†åŒ–
- æŽ¨ç†æ—¶é—´åˆ†æž

## ðŸ“ æ€»ç»“

é€šè¿‡è¿™æ¬¡å…¨é¢çš„å¯è§†åŒ–æ”¹è¿›ï¼Œæˆ‘ä»¬æˆåŠŸå®žçŽ°äº†ï¼š

âœ… **æ‰€æœ‰ç”¨æˆ·è¦æ±‚**ï¼šå±‚åç§°ç®€åŒ–ã€å±…ä¸­å¯¹é½ã€ç»´åº¦ä¿¡æ¯ã€é¢œè‰²é«˜äº®ã€åˆ é™¤çº¿æ˜¾ç¤º

âœ… **é¢å¤–å¢žå¼ºåŠŸèƒ½**ï¼šM/Kå‚æ•°æ ¼å¼ã€å¤šåˆ†æ”¯æ”¯æŒã€å›¾ä¾‹è¯´æ˜Žã€çŠ¶æ€æ ‡è¯†

âœ… **æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ**ï¼šæ¸…æ™°çš„è§†è§‰å±‚æ¬¡ã€ä¸°å¯Œçš„ä¿¡æ¯å¯†åº¦ã€ç›´è§‚çš„å˜åŒ–æ ‡è¯†

è¿™äº›æ”¹è¿›ä½¿å¾— Neuro Exapt çš„åŠ¨æ€æž¶æž„å¯è§†åŒ–åŠŸèƒ½è¾¾åˆ°äº†**å­¦æœ¯çº§åˆ«çš„ä¸“ä¸šæ°´å‡†**ï¼Œä¸ºç¥žç»ç½‘ç»œæž¶æž„æ¼”åŒ–æä¾›äº†å¼ºå¤§çš„å¯è§†åŒ–æ”¯æŒã€‚

---

*å¯è§†åŒ–æ˜¯ç†è§£å¤æ‚ç³»ç»Ÿçš„çª—å£ï¼Œä¼˜ç§€çš„å¯è§†åŒ–è®©æž¶æž„æ¼”åŒ–è¿‡ç¨‹å˜å¾—æ¸…æ™°å¯è§ã€‚* ðŸŽ¨âœ¨ 