# 迅雷下载路径配置指南

## 问题描述

当使用 Neuro Exapt 的迅雷下载功能时，迅雷弹出的下载窗口可能显示的是您平时使用的默认路径，而不是项目指定的路径。这是因为迅雷的URL协议调用无法直接指定保存路径。

## 解决方案

### 方法1: 自动配置 (推荐)

运行配置助手来自动设置迅雷的默认下载路径：

```bash
python -m neuroexapt.utils.xunlei_config_helper
```

配置助手会：
1. 检测当前的迅雷配置
2. 建议将默认下载路径设置为项目的 `datasets/` 目录
3. 自动通过注册表或配置文件更新设置

### 方法2: 手动配置

1. **打开迅雷**
2. **点击右上角设置图标** ⚙️
3. **选择"下载设置"**
4. **在"默认下载目录"中设置**: `D:\Repo\neuroexapt\datasets`
5. **点击"确定"保存**

### 方法3: 注册表配置

1. **按 Win+R**，输入 `regedit`
2. **导航到**: `HKEY_CURRENT_USER\SOFTWARE\Thunder Network\Thunder`
3. **创建字符串值**: `DefaultDownloadPath`
4. **设置值为**: `D:\Repo\neuroexapt\datasets`

## 验证配置

配置完成后，您可以：

1. **运行测试脚本**:
   ```bash
   python test_xunlei_path.py
   ```

2. **检查迅雷下载窗口**:
   - 启动下载后，迅雷弹出的窗口应该显示正确的保存路径
   - 路径应该是: `D:\Repo\neuroexapt\datasets\文件名`

## 故障排除

### 如果配置助手无法自动设置

1. **检查权限**: 确保以管理员身份运行
2. **手动配置**: 使用上述方法2或方法3
3. **重启迅雷**: 配置更改后重启迅雷

### 如果迅雷仍然使用旧路径

1. **清除迅雷缓存**: 删除迅雷的临时文件
2. **重新安装迅雷**: 如果问题持续存在
3. **使用.thunder文件**: 双击生成的.thunder文件，手动设置保存路径

## 高级配置

### 为不同项目设置不同路径

如果您有多个项目，可以为每个项目创建不同的配置：

```python
# 在项目根目录创建 .xunlei_config.json
{
    "download_path": "./datasets",
    "auto_config": true
}
```

### 批量下载配置

对于批量下载，建议：

1. **先配置好默认路径**
2. **使用项目的迅雷下载器**
3. **检查下载的文件是否在正确位置**

## 技术说明

### 为什么URL协议无法指定路径

迅雷的 `thunder://` URL协议主要用于快速启动下载，但无法传递复杂的参数如保存路径。这是迅雷的设计限制。

### 配置优先级

1. **COM接口** (最可靠，但需要pywin32)
2. **命令行参数** (部分版本支持)
3. **URL协议** (无法指定路径)
4. **.thunder文件** (需要手动操作)

### 支持的迅雷版本

- 迅雷9及以上版本
- 迅雷极速版
- 迅雷X

## 联系支持

如果遇到问题，请：

1. **查看日志**: 检查控制台输出的错误信息
2. **提交Issue**: 在GitHub上提交问题报告
3. **社区讨论**: 在GitHub Discussions中寻求帮助

---

*最后更新: 2025年1月* 